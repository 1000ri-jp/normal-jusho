(function(s,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(s=typeof globalThis<"u"?globalThis:s||self,u(s.Jusho={}))})(this,(function(s){"use strict";const u="https://api.jusho.dev",h=/^(\d{3})-?(\d{4})$/;function E(e){const n=e.replace(/[\s\u3000]/g,"").replace(/[０-９]/g,t=>String.fromCharCode(t.charCodeAt(0)-65248)).match(h);return n?n[1]+n[2]:null}function y(e,o){let n=null;return((...t)=>{n&&clearTimeout(n),n=setTimeout(()=>e(...t),o)})}async function m(e,o){try{const n=await fetch(`${o}/postal/${e}`);if(!n.ok)return null;const t=await n.json();return{post_code:t.post_code??t.postal_code??e,pref:t.pref??"",city:t.city??"",town:t.town??"",address:[t.pref??"",t.city??"",t.town??""].join(""),full_address:t.full_address??[t.pref??"",t.city??"",t.town??""].join("")}}catch{return null}}function v(e,o){const n=e.closest("form")??e.parentElement;if(!n)return;const t={pref:"pref",city:"city",town:"town",address:"full_address"};for(const[d,a]of Object.entries(t)){const r=n.querySelector(`[data-jusho="${d}"]`);if(!r)continue;const f=o[a];if(r.tagName==="SELECT"){const l=r;for(let i=0;i<l.options.length;i++)if(l.options[i].text===f||l.options[i].value===f){l.selectedIndex=i;break}}else r.value=f;r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0}))}}function p(e,o={}){const n=o.apiUrl??u,t=o.debounce??300,d=y(async()=>{const a=E(e.value);if(!a)return;const r=await m(a,n);if(!r){o.onError&&o.onError(new Error("Address not found"));return}v(e,r),o.onResolve&&o.onResolve(r)},t);return e.addEventListener("input",d),()=>{e.removeEventListener("input",d)}}const c={attach(e,o={}){const n=typeof e=="string"?document.querySelector(e):e;return n?p(n,o):(console.warn(`[Jusho] Element not found: ${e}`),()=>{})},init(){document.querySelectorAll('[data-jusho="postal"]').forEach(o=>p(o))}};typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>c.init()):c.init()),typeof window<"u"&&(window.Jusho=c),s.Jusho=c,s.default=c,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
